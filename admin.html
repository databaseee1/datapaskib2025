<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    section { margin-bottom: 40px; }
    .card { background:#f9f9f9; padding:15px; border-radius:10px; margin:10px 0; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    input, select, textarea, button { margin: 5px 0; padding: 8px; width: 100%; }
  </style>
</head>
<body>
  <h1>ğŸ“Š Admin Panel Toko</h1>

  <section id="orderanBaru">
    <h2>ğŸ“¦ Orderan Baru</h2>
    <div id="listOrderan"></div>
  </section>

  <section id="isiSaldoUser">
    <h2>ğŸ’° Request Isi Saldo</h2>
    <div id="listTopup"></div>
  </section>

  <section id="uploadProduk">
    <h2>ğŸ›ï¸ Upload Produk</h2>
    <select id="jenisProduk">
      <option value="digital">Produk Digital</option>
      <option value="fisik">Produk Fisik</option>
    </select>
    <input type="text" id="namaProduk" placeholder="Nama Produk">
    <input type="number" id="hargaProduk" placeholder="Harga Produk">
    <button onclick="uploadProduk()">Upload Produk</button>
  </section>

  <section id="laporanOrder">
    <h2>ğŸ“ˆ Laporan Order</h2>
    <div id="laporan"></div>
  </section>

  <section id="dataPembeli">
    <h2>ğŸ§‘â€ğŸ’¼ Data Pembeli</h2>
    <div id="listPembeli"></div>
  </section>

  <section id="gantiBanner">
    <h2>ğŸ–¼ï¸ Ganti Banner Promosi</h2>
    <input type="text" id="judulBanner" placeholder="Judul Promosi">
    <input type="text" id="urlGambarBanner" placeholder="Link Gambar Banner">
    <button onclick="gantiBanner()">Update Banner</button>
    <div id="previewBanner"></div>
  </section>

  <script>
 const firebaseConfig = {
  apiKey: "AIzaSyDkkrmYKIh6hejmTWf3acvLVImIAMOMNKU",
  authDomain: "users-96dc5.firebaseapp.com",
  projectId: "users-96dc5",
  storageBucket: "users-96dc5.appspot.com",
  messagingSenderId: "483322415863",
  appId: "1:483322415863:web:1397a8f2e808e66ad9e1f2"
};


    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. Orderan Baru
    db.ref("orderan").on("value", snap => {
      const data = snap.val();
      let html = "";
      for (let id in data) {
        const o = data[id];
        html += `<div class="card">
          <b>${o.namaProduk}</b><br>
          Pembeli: ${o.nama} - ${o.whatsapp}<br>
          Status: ${o.status}<br>
          <button onclick="setOrderDiproses('${id}')">Tandai Diproses</button>
        </div>`;
      }
      document.getElementById("listOrderan").innerHTML = html;
    });

    function setOrderDiproses(id) {
      db.ref("orderan/" + id + "/status").set("Diproses");
    }

    // 2. Isi Saldo
    db.ref("topup").on("value", snap => {
      const data = snap.val();
      let html = "";
      for (let id in data) {
        const t = data[id];
        html += `<div class="card">
          ${t.nama} - ${t.nominal} <br>
          <button onclick="approveTopup('${id}', '${t.uid}', ${t.nominal})">Uprove</button>
        </div>`;
      }
      document.getElementById("listTopup").innerHTML = html;
    });

    function approveTopup(id, uid, nominal) {
      const saldoRef = db.ref("users/" + uid + "/saldo");
      saldoRef.once("value").then(snap => {
        const saldoLama = snap.val() || 0;
        saldoRef.set(saldoLama + nominal);
        db.ref("topup/" + id).remove();
      });
    }

    // 3. Upload Produk
    function uploadProduk() {
      const jenis = document.getElementById("jenisProduk").value;
      const nama = document.getElementById("namaProduk").value;
      const harga = parseInt(document.getElementById("hargaProduk").value);
      if (!nama || !harga) return alert("Lengkapi data!");

      const ref = jenis === "digital" ? "produkDigital" : "produkFisik";
      db.ref(ref).push({ nama, harga });
      alert("Produk ditambahkan");
    }

    // 4. Laporan Order
    db.ref("orderan").on("value", snap => {
      let totalMasuk = 0;
      let totalKeluar = 0;
      snap.forEach(child => {
        const o = child.val();
        if (o.status === "Selesai") {
          totalMasuk += parseInt(o.harga);
        } else {
          totalKeluar += parseInt(o.harga);
        }
      });
      document.getElementById("laporan").innerHTML = `
        <div class="card">
          Total Masuk: Rp ${totalMasuk.toLocaleString()}<br>
          Total Belum Diproses: Rp ${totalKeluar.toLocaleString()}
        </div>`;
    });

    // 5. Data Pembeli
    db.ref("users").on("value", snap => {
      const data = snap.val();
      let html = "";
      for (let uid in data) {
        const u = data[uid];
        html += `<div class="card">
          ${u.nama} - ${u.whatsapp}<br>
          Email: ${u.email}<br>
          <button onclick="banUser('${uid}')">Banned</button>
          <button onclick="deleteUser('${uid}')">Delete</button>
        </div>`;
      }
      document.getElementById("listPembeli").innerHTML = html;
    });

    function banUser(uid) {
      db.ref("users/" + uid + "/banned").set(true);
    }

    function deleteUser(uid) {
      db.ref("users/" + uid).remove();
    }

    // 6. Ganti Banner
    function gantiBanner() {
      const judul = document.getElementById("judulBanner").value;
      const url = document.getElementById("urlGambarBanner").value;
      db.ref("toko/banner").set({ judul, url });
      document.getElementById("previewBanner").innerHTML = `
        <div class="card">
          <b>${judul}</b><br>
          <img src="${url}" style="width:100%; max-width:300px;">
        </div>`;
    }

    // Tampilkan banner saat ini
    db.ref("toko/banner").on("value", snap => {
      const data = snap.val();
      if (data) {
        document.getElementById("previewBanner").innerHTML = `
          <div class="card">
            <b>${data.judul}</b><br>
            <img src="${data.url}" style="width:100%; max-width:300px;">
          </div>`;
      }
    });
  </script>
</body>
</html>
